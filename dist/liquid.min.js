var Liquid={author:"Matt McCray <darthapo@gmail.com>",version:"1.3.1",readTemplateFile:function(){throw"This liquid context does not allow includes.";},registerFilters:function(n){Liquid.Template.registerFilter(n)},parse:function(n){return Liquid.Template.parse(n)}},hackObjectEach,split;Array.prototype.indexOf||(Array.prototype.indexOf=function(n){for(var t=0;t<this.length;t++)if(this[t]==n)return t;return-1});Array.prototype.clear||(Array.prototype.clear=function(){this.length=0});Array.prototype.map||(Array.prototype.map=function(n){var r=this.length,i,u,t;if(typeof n!="function")throw"Array.map requires first argument to be a function";for(i=new Array(r),u=arguments[1],t=0;t<r;t++)t in this&&(i[t]=n.call(u,this[t],t,this));return i});Array.prototype.first||(Array.prototype.first=function(){return this[0]});Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]});Array.prototype.flatten||(Array.prototype.flatten=function(){for(var i=this.length,t=[],n=0;n<i;n++)this[n]instanceof Array?t=t.concat(this[n]):t.push(this[n]);return t});Array.prototype.each||(Array.prototype.each=function(n){var r=this.length,i,t;if(typeof n!="function")throw"Array.each requires first argument to be a function";for(i=arguments[1],t=0;t<r;t++)t in this&&n.call(i,this[t],t,this);return null});Array.prototype.include||(Array.prototype.include=function(n){var t=this.length;return this.indexOf(n)>=0});String.prototype.capitalize||(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()});String.prototype.strip||(String.prototype.strip=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});Liquid.extensions={};Liquid.extensions.object={};Liquid.extensions.object.update=function(n){for(var t in n)this[t]=n[t];return this};Liquid.extensions.object.hasKey=function(n){return!!this[n]};Liquid.extensions.object.hasValue=function(n){for(var t in this)if(this[t]==n)return!0;return!1},function(){var n=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(i){function u(){!n&&this.init&&this.init.apply(this,arguments)}var e=this.prototype,f,r;n=!0;f=new this;n=!1;for(r in i)f[r]=typeof i[r]=="function"&&typeof e[r]=="function"&&t.test(i[r])?function(n,t){return function(){var r=this._super,i;return this._super=e[n],i=t.apply(this,arguments),this._super=r,i}}(r,i[r]):i[r];return u.prototype=f,u.prototype.constructor=u,u.extend=arguments.callee,u}}();Liquid.Tag=Class.extend({init:function(n,t,i){this.tagName=n;this.markup=t;this.nodelist=this.nodelist||[];this.parse(i)},parse:function(){},render:function(){return""}});Liquid.Block=Liquid.Tag.extend({init:function(n,t,i){this.blockName=n;this.blockDelimiter="end"+this.blockName;this._super(n,t,i)},parse:function(n){var i,t;for(this.nodelist||(this.nodelist=[]),this.nodelist.clear(),i=n.shift(),n.push("");n.length;){if(/^\{\%/.test(i))if(t=i.match(/^\{\%\s*(\w+)\s*(.*)?\%\}$/),t){if(this.blockDelimiter==t[1]){this.endTag();return}t[1]in Liquid.Template.tags?this.nodelist.push(new Liquid.Template.tags[t[1]](t[1],t[2],n)):this.unknownTag(t[1],t[2],n)}else throw"Tag '"+i+"' was not properly terminated with: %}";else/^\{\{/.test(i)?this.nodelist.push(this.createVariable(i)):this.nodelist.push(i);i=n.shift()}this.assertMissingDelimitation()},endTag:function(){},unknownTag:function(n){switch(n){case"else":throw this.blockName+" tag does not expect else tag";case"end":throw"'end' is not a valid delimiter for "+this.blockName+" tags. use "+this.blockDelimiter;default:throw"Unknown tag: "+n;}},createVariable:function(n){var t=n.match(/^\{\{(.*)\}\}$/);if(t)return new Liquid.Variable(t[1]);throw"Variable '"+n+"' was not properly terminated with: }}";},render:function(n){return this.renderAll(this.nodelist,n)},renderAll:function(n,t){return(n||[]).map(function(n){var i="";try{i=n.render?n.render(t):n}catch(r){i=t.handleError(r)}return i})},assertMissingDelimitation:function(){throw this.blockName+" tag was never closed";}});Liquid.Document=Liquid.Block.extend({init:function(n){this.blockDelimiter=[];this.parse(n)},assertMissingDelimitation:function(){}});Liquid.Strainer=Class.extend({init:function(n){this.context=n},respondTo:function(n){return(n=n.toString(),n.match(/^__/))?!1:Liquid.Strainer.requiredMethods.include(n)?!1:n in this}});Liquid.Strainer.filters={};Liquid.Strainer.globalFilter=function(n){for(var t in n)Liquid.Strainer.filters[t]=n[t]};Liquid.Strainer.requiredMethods=["respondTo","context"];Liquid.Strainer.create=function(n){var t=new Liquid.Strainer(n);for(var i in Liquid.Strainer.filters)t[i]=Liquid.Strainer.filters[i];return t};Liquid.Context=Class.extend({init:function(n,t,i){this.scopes=[n?n:{}];this.registers=t?t:{};this.errors=[];this.rethrowErrors=i;this.strainer=Liquid.Strainer.create(this)},get:function(n){return this.resolve(n)},set:function(n,t){this.scopes[0][n]=t},hasKey:function(n){return this.resolve(n)?!0:!1},push:function(){var n={};return this.scopes.unshift(n),n},merge:function(n){return Liquid.extensions.object.update.call(this.scopes[0],n)},pop:function(){if(this.scopes.length==1)throw"Context stack error";return this.scopes.shift()},stack:function(n,t){var i=null;this.push();try{i=n.apply(t?t:this.strainer)}finally{this.pop()}return i},invoke:function(n,t){return this.strainer.respondTo(n)?this.strainer[n].apply(this.strainer,t):t.length==0?null:t[0]},resolve:function(n){var f,t;switch(n){case null:case"nil":case"null":case"":return null;case"true":return!0;case"false":return!1;case"blank":case"empty":return"";default:if(/^'(.*)'$/.test(n))return n.replace(/^'(.*)'$/,"$1");if(/^"(.*)"$/.test(n))return n.replace(/^"(.*)"$/,"$1");if(/^(\d+)$/.test(n))return parseInt(n.replace(/^(\d+)$/,"$1"));if(/^(\d[\d\.]+)$/.test(n))return parseFloat(n.replace(/^(\d[\d\.]+)$/,"$1"));if(/^\((\S+)\.\.(\S+)\)$/.test(n)){var r=n.match(/^\((\S+)\.\.(\S+)\)$/),i=parseInt(r[1]),u=parseInt(r[2]),e=[];if(isNaN(i)||isNaN(u))for(i=r[1].charCodeAt(0),u=r[2].charCodeAt(0),f=u-i+1,t=0;t<f;t++)e.push(String.fromCharCode(t+i));else for(f=u-i+1,t=0;t<f;t++)e.push(t+i);return e}return this.variable(n)}},findVariable:function(n){for(var i,t,r=0;r<this.scopes.length;r++)if(i=this.scopes[r],i&&typeof i[n]!="undefined")return t=i[n],typeof t=="function"&&(t=t.apply(this),i[n]=t),t&&this._isObject(t)&&"toLiquid"in t&&(t=t.toLiquid()),t&&this._isObject(t)&&"setContext"in t&&t.setContext(self),t;return null},variable:function(n){var t,i;if(typeof n!="string")return null;var u=n.match(/\[[^\]]+\]|(?:[\w\-]\??)+/g),r=u.shift(),f=r.match(/^\[(.*)\]$/);return f&&(r=this.resolve(f[1])),t=this.findVariable(r),i=this,t&&u.each(function(n){var f=n.match(/^\[(.*)\]$/),n,r,u;if(f)n=i.resolve(f[1]),typeof t[n]=="function"&&(t[n]=t[n].apply(this)),t=t[n],i._isObject(t)&&"toLiquid"in t&&(t=t.toLiquid());else{if((i._isObject(t)||typeof t=="hash")&&n in t)r=t[n],typeof r=="function"&&(r=t[n]=r.apply(i)),t=i._isObject(r)&&"toLiquid"in r?r.toLiquid():r;else if(/^\d+$/.test(n))u=parseInt(n),typeof t[u]=="function"&&(t[u]=t[u].apply(i)),t=i._isObject(t)&&i._isObject(t[u])&&"toLiquid"in t[u]?t[u].toLiquid():t[u];else if(t&&typeof t[n]=="function"&&["length","size","first","last"].include(n))t=t[n].apply(n),"toLiquid"in t&&(t=t.toLiquid());else return t=null;i._isObject(t)&&"setContext"in t&&t.setContext(i)}}),t},addFilters:function(n){n=n.flatten();n.each(function(n){if(!this._isObject(n))throw"Expected object but got: "+typeof n;this.strainer.addMethods(n)})},handleError:function(n){if(this.errors.push(n),this.rethrowErrors)throw n;return"Liquid error: "+(n.message?n.message:n.description?n.description:n)},_isObject:function(n){return n!=null&&typeof n=="object"}});Liquid.Template=Class.extend({init:function(){this.root=null;this.registers={};this.assigns={};this.errors=[];this.rethrowErrors=!1},parse:function(n){return this.root=new Liquid.Document(Liquid.Template.tokenize(n)),this},render:function(){if(!this.root)return"";var n={ctx:arguments[0],filters:arguments[1],registers:arguments[2]},t=null;n.ctx instanceof Liquid.Context?(t=n.ctx,this.assigns=t.assigns,this.registers=t.registers):(n.ctx&&Liquid.extensions.object.update.call(this.assigns,n.ctx),n.registers&&Liquid.extensions.object.update.call(this.registers,n.registers),t=new Liquid.Context(this.assigns,this.registers,this.rethrowErrors));n.filters&&t.addFilters(arg.filters);try{return this.root.render(t).join("")}finally{this.errors=t.errors}},renderWithErrors:function(){var t=this.rethrowErrors,n;return this.rethrowErrors=!0,n=this.render.apply(this,arguments),this.rethrowErrors=t,n}});Liquid.Template.tags={};Liquid.Template.registerTag=function(n,t){Liquid.Template.tags[n]=t};Liquid.Template.registerFilter=function(n){Liquid.Strainer.globalFilter(n)};Liquid.Template.tokenize=function(n){var t=n.split(/(\{\%.*?\%\}|\{\{.*?\}\}?)/);return t[0]==""&&t.shift(),t};Liquid.Template.parse=function(n){return(new Liquid.Template).parse(n)};Liquid.Variable=Class.extend({init:function(n){var r,t,i,u;this.markup=n;this.name=null;this.filters=[];r=this;t=n.match(/\s*("[^"]+"|'[^']+'|[^\s,|]+)/);t&&(this.name=t[1],i=n.match(/\|\s*(.*)/),i&&(u=i[1].split(/\|/),u.each(function(n){var i=n.match(/\s*(\w+)/),u,t;i&&(u=i[1],t=[],(n.match(/(?:[:|,]\s*)("[^"]+"|'[^']+'|[^\s,|]+)/g)||[]).flatten().each(function(n){var i=n.match(/^[\s|:|,]*(.*?)[\s]*$/);i&&t.push(i[1])}),r.filters.push([u,t]))})))},render:function(n){if(this.name==null)return"";var t=n.get(this.name);return this.filters.each(function(i){var u=i[0],r=(i[1]||[]).map(function(t){return n.get(t)});r.unshift(t);t=n.invoke(u,r)}),t}});Liquid.Condition=Class.extend({init:function(n,t,i){this.left=n;this.operator=t;this.right=i;this.childRelation=null;this.childCondition=null;this.attachment=null},evaluate:function(n){n=n||new Liquid.Context;var t=this.interpretCondition(this.left,this.right,this.operator,n);switch(this.childRelation){case"or":return t||this.childCondition.evaluate(n);case"and":return t&&this.childCondition.evaluate(n);default:return t}},or:function(n){this.childRelation="or";this.childCondition=n},and:function(n){this.childRelation="and";this.childCondition=n},attach:function(n){return this.attachment=n,this.attachment},isElse:!1,interpretCondition:function(n,t,i,r){if(!i)return r.get(n);if(n=r.get(n),t=r.get(t),i=Liquid.Condition.operators[i.replace("&gt;",">").replace("&lt;","<")],!i)throw"Unknown operator "+i;return i(n,t)},toString:function(){return"<Condition "+this.left+" "+this.operator+" "+this.right+">"}});Liquid.Condition.operators={"==":function(n,t){return n==t},"=":function(n,t){return n==t},"!=":function(n,t){return n!=t},"<>":function(n,t){return n!=t},"<":function(n,t){return n<t},">":function(n,t){return n>t},"<=":function(n,t){return n<=t},">=":function(n,t){return n>=t},contains:function(n,t){return Object.prototype.toString.call(n)==="[object Array]"?n.indexOf(t)>=0:n.match(t)},hasKey:function(n,t){return Liquid.extensions.object.hasKey.call(n,t)},hasValue:function(n,t){return Liquid.extensions.object.hasValue.call(n,t)}};Liquid.ElseCondition=Liquid.Condition.extend({isElse:!0,evaluate:function(){return!0},toString:function(){return"<ElseCondition>"}});Liquid.Drop=Class.extend({setContext:function(n){this.context=n},beforeMethod:function(){},invokeDrop:function(n){var t=this.beforeMethod();return!t&&n in this&&(t=this[n].apply(this)),t},hasKey:function(){return!0}});hackObjectEach=function(n){var r,f,t,u,i;if(typeof n!="function")throw"Object.each requires first argument to be a function";r=0;f=arguments[1];for(t in this)u=this[t],i=[t,u],i.key=t,i.value=u,n.call(f,i,r,this),r++;return null};Liquid.Template.registerTag("assign",Liquid.Tag.extend({tagSyntax:/((?:\(?[\w\-\.\[\]]\)?)+)\s*=\s*(.+)/,init:function(n,t,i){var r=t.match(this.tagSyntax);if(r)this.to=r[1],this.from=r[2];else throw"Syntax error in 'assign' - Valid syntax: assign [var] = [source]";this._super(n,t,i)},render:function(n){var t=new Liquid.Variable(this.from);return n.scopes.last()[this.to.toString()]=t.render(n),""}}));Liquid.Template.registerTag("cache",Liquid.Block.extend({tagSyntax:/(\w+)/,init:function(n,t,i){var r=t.match(this.tagSyntax);if(r)this.to=r[1];else throw"Syntax error in 'cache' - Valid syntax: cache [var]";this._super(n,t,i)},render:function(n){var t=this._super(n);return n.scopes.last()[this.to]=[t].flatten().join(""),""}}));Liquid.Template.registerTag("capture",Liquid.Block.extend({tagSyntax:/(\w+)/,init:function(n,t,i){var r=t.match(this.tagSyntax);if(r)this.to=r[1];else throw"Syntax error in 'capture' - Valid syntax: capture [var]";this._super(n,t,i)},render:function(n){var t=this._super(n);return n.scopes.last()[this.to.toString()]=[t].flatten().join(""),""}}));Liquid.Template.registerTag("case",Liquid.Block.extend({tagSyntax:/("[^"]+"|'[^']+'|[^\s,|]+)/,tagWhenSyntax:/("[^"]+"|'[^']+'|[^\s,|]+)(?:(?:\s+or\s+|\s*\,\s*)("[^"]+"|'[^']+'|[^\s,|]+.*))?/,init:function(n,t,i){this.blocks=[];this.nodelist=[];var r=t.match(this.tagSyntax);if(r)this.left=r[1];else throw"Syntax error in 'case' - Valid syntax: case [condition]";this._super(n,t,i)},unknownTag:function(n,t,i){switch(n){case"when":this.recordWhenCondition(t);break;case"else":this.recordElseCondition(t);break;default:this._super(n,t,i)}},render:function(n){var i=this,t=[],r=!0;return n.stack(function(){for(var u,f=0;f<i.blocks.length;f++){if(u=i.blocks[f],u.isElse)return r==!0&&(t=[t,i.renderAll(u.attachment,n)].flatten()),t;u.evaluate(n)&&(r=!1,t=[t,i.renderAll(u.attachment,n)].flatten())}}),t},recordWhenCondition:function(n){for(var t,i;n;){if(t=n.match(this.tagWhenSyntax),!t)throw"Syntax error in tag 'case' - Valid when condition: {% when [condition] [or condition2...] %} ";n=t[2];i=new Liquid.Condition(this.left,"==",t[1]);this.blocks.push(i);this.nodelist=i.attach([])}},recordElseCondition:function(n){if((n||"").strip()!="")throw"Syntax error in tag 'case' - Valid else condition: {% else %} (no parameters) ";var t=new Liquid.ElseCondition;this.blocks.push(t);this.nodelist=t.attach([])}}));Liquid.Template.registerTag("comment",Liquid.Block.extend({render:function(){return""}}));Liquid.Template.registerTag("cycle",Liquid.Tag.extend({tagSimpleSyntax:/"[^"]+"|'[^']+'|[^\s,|]+/,tagNamedSyntax:/("[^"]+"|'[^']+'|[^\s,|]+)\s*\:\s*(.*)/,init:function(n,t,i){var r;if(r=t.match(this.tagNamedSyntax),r)this.variables=this.variablesFromString(r[2]),this.name=r[1];else if(r=t.match(this.tagSimpleSyntax),r)this.variables=this.variablesFromString(t),this.name="'"+this.variables.toString()+"'";else throw"Syntax error in 'cycle' - Valid syntax: cycle [name :] var [, var2, var3 ...]";this._super(n,t,i)},render:function(n){var i=this,t=n.get(i.name),r="";return n.registers.cycle||(n.registers.cycle={}),n.registers.cycle[t]||(n.registers.cycle[t]=0),n.stack(function(){var u=n.registers.cycle[t],f=n.get(i.variables[u]);u+=1;u==i.variables.length&&(u=0);n.registers.cycle[t]=u;r=f}),r},variablesFromString:function(n){return n.split(",").map(function(n){var t=n.match(/\s*("[^"]+"|'[^']+'|[^\s,|]+)\s*/);return t[1]?t[1]:null})}}));Liquid.Template.registerTag("for",Liquid.Block.extend({tagSyntax:/(\w+)\s+in\s+((?:\(?[\w\-\.\[\]]\)?)+)/,init:function(n,t,i){var r=t.match(this.tagSyntax),f,u;if(r)this.variableName=r[1],this.collectionName=r[2],this.name=this.variableName+"-"+this.collectionName,this.attributes={},f=t.replace(this.tagSyntax,""),u=t.match(/(\w*?)\s*\:\s*("[^"]+"|'[^']+'|[^\s,|]+)/g),u&&u.each(function(n){n=n.split(":");this.attributes[n[0].strip()]=n[1].strip()},this);else throw"Syntax error in 'for loop' - Valid syntax: for [item] in [collection]";this._super(n,t,i)},render:function(n){var i=this,s=[],r=n.get(this.collectionName)||[],u=[0,r.length];if(n.registers["for"]||(n.registers["for"]={}),this.attributes.limit||this.attributes.offset){var f=0,e=0,o=0,t=null;f=this.attributes.offset=="continue"?n.registers["for"][this.name]:n.get(this.attributes.offset)||0;e=n.get(this.attributes.limit);o=e?f+e+1:r.length;u=[f,o-1];n.registers["for"][this.name]=o}return(t=r.slice(u[0],u[1]),!t||t.length==0)?"":(n.stack(function(){var r=t.length;t.each(function(t,u){n.set(i.variableName,t);n.set("forloop",{name:i.name,length:r,index:u+1,index0:u,rindex:r-u,rindex0:r-u-1,first:u==0,last:u==r-1});s.push((i.renderAll(i.nodelist,n)||[]).join(""))})}),[s].flatten().join(""))}}));Liquid.Template.registerTag("if",Liquid.Block.extend({tagSyntax:/("[^"]+"|'[^']+'|[^\s,|]+)\s*([=!&;<>a-z_]+)?\s*("[^"]+"|'[^']+'|[^\s,|]+)?/,init:function(n,t,i){this.nodelist=[];this.blocks=[];this.pushBlock("if",t);this._super(n,t,i)},unknownTag:function(n,t,i){["elsif","else"].include(n)?this.pushBlock(n,t):this._super(n,t,i)},render:function(n){var t=this,i="";return n.stack(function(){for(var u,r=0;r<t.blocks.length;r++)if(u=t.blocks[r],u.evaluate(n)){i=t.renderAll(u.attachment,n);return}}),[i].flatten().join("")},pushBlock:function(n,t){var r,u,f,o,i,e;if(n=="else")r=new Liquid.ElseCondition;else{if(u=t.split(/\b(and|or)\b/).reverse(),i=u.shift().match(this.tagSyntax),!i)throw"Syntax Error in tag '"+n+"' - Valid syntax: "+n+" [expression]";for(f=new Liquid.Condition(i[1],i[2],i[3]);u.length>0;){if(o=u.shift(),i=u.shift().match(this.tagSyntax),!i)throw"Syntax Error in tag '"+n+"' - Valid syntax: "+n+" [expression]";e=new Liquid.Condition(i[1],i[2],i[3]);e[o](f);f=e}r=f}r.attach([]);this.blocks.push(r);this.nodelist=r.attachment}}));Liquid.Template.registerTag("ifchanged",Liquid.Block.extend({render:function(n){var i=this,t="";return n.stack(function(){var r=i.renderAll(i.nodelist,n).join("");r!=n.registers.ifchanged&&(t=r,n.registers.ifchanged=t)}),t}}));Liquid.Template.registerTag("include",Liquid.Tag.extend({tagSyntax:/((?:"[^"]+"|'[^']+'|[^\s,|]+)+)(\s+(?:with|for)\s+((?:"[^"]+"|'[^']+'|[^\s,|]+)+))?/,init:function(n,t,i){var r=(t||"").match(this.tagSyntax),u;if(r)this.templateName=r[1],this.templateNameVar=this.templateName.substring(1,this.templateName.length-1),this.variableName=r[3],this.attributes={},u=t.match(/(\w*?)\s*\:\s*("[^"]+"|'[^']+'|[^\s,|]+)/g),u&&u.each(function(n){n=n.split(":");this.attributes[n[0].strip()]=n[1].strip()},this);else throw"Error in tag 'include' - Valid syntax: include '[template]' (with|for) [object|collection]";this._super(n,t,i)},render:function(n){var t=this,f=Liquid.readTemplateFile(n.get(this.templateName)),u=Liquid.parse(f),r=n.get(this.variableName||this.templateNameVar),i="";return n.stack(function(){t.attributes.each=hackObjectEach;t.attributes.each(function(t){n.set(t.key,n.get(t.value))});r instanceof Array?i=r.map(function(i){return n.set(t.templateNameVar,i),u.render(n)}):(n.set(t.templateNameVar,r),i=u.render(n))}),i=[i].flatten().join("")}}));Liquid.Template.registerTag("unless",Liquid.Template.tags["if"].extend({render:function(n){var t=this,i="";return n.stack(function(){var r=t.blocks[0],u;if(!r.evaluate(n)){i=t.renderAll(r.attachment,n);return}for(u=1;u<t.blocks.length;u++)if(r=t.blocks[u],r.evaluate(n)){i=t.renderAll(r.attachment,n);return}}),[i].flatten().join("")}}));Liquid.Template.registerTag("raw",Liquid.Block.extend({parse:function(n){var t,i;for(this.nodelist||(this.nodelist=[]),this.nodelist.clear(),t=n.shift(),n.push("");n.length;){if(/^\{\%/.test(t)&&(i=t.match(/^\{\%\s*(\w+)\s*(.*)?\%\}$/),i&&this.blockDelimiter==i[1])){this.endTag();return}this.nodelist.push(t||"");t=n.shift()}this.assertMissingDelimitation()},render:function(){return this.nodelist.join("")}}));Liquid.Template.registerFilter({_HTML_ESCAPE_MAP:{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"},size:function(n){return n.length?n.length:0},downcase:function(n){return n.toString().toLowerCase()},upcase:function(n){return n.toString().toUpperCase()},capitalize:function(n){return n.toString().capitalize()},escape:function(n){var t=this;return n.replace(/[&<>"']/g,function(n){return t._HTML_ESCAPE_MAP[n]})},h:function(n){var t=this;return n.replace(/[&<>"']/g,function(n){return t._HTML_ESCAPE_MAP[n]})},truncate:function(n,t,i){if(!n||n=="")return"";t=t||50;i=i||"...";var r=n.slice(0,t);return n.length>t?n.slice(0,t)+i:n},truncatewords:function(n,t,i){if(!n||n=="")return"";t=parseInt(t||15);i=i||"...";var r=n.toString().split(" "),u=Math.max(t,0);return r.length>u?r.slice(0,u).join(" ")+i:n},truncate_words:function(n,t,i){if(!n||n=="")return"";t=parseInt(t||15);i=i||"...";var r=n.toString().split(" "),u=Math.max(t,0);return r.length>u?r.slice(0,u).join(" ")+i:n},strip_html:function(n){return n.toString().replace(/<.*?>/g,"")},strip_newlines:function(n){return n.toString().replace(/\n/g,"")},join:function(n,t){return t=t||" ",n.join(t)},split:function(n,t){return t=t||" ",n.split(t)},sort:function(n){return n.sort()},reverse:function(n){return n.reverse()},replace:function(n,t,i){return i=i||"",n.toString().replace(new RegExp(t,"g"),i)},replace_first:function(n,t,i){return i=i||"",n.toString().replace(new RegExp(t,""),i)},newline_to_br:function(n){return n.toString().replace(/\n/g,"<br/>\n")},date:function(n,t){var i;return(n instanceof Date&&(i=n),i instanceof Date||n!="now"||(i=new Date),i instanceof Date||typeof n!="number"||(i=new Date(n*1e3)),i instanceof Date||typeof n!="string"||(i=new Date(Date.parse(n))),!(i instanceof Date))?n:i.strftime(t)},first:function(n){return n[0]},last:function(n){return n=n,n[n.length-1]},minus:function(n,t){return(Number(n)||0)-(Number(t)||0)},plus:function(n,t){return(Number(n)||0)+(Number(t)||0)},times:function(n,t){return(Number(n)||0)*(Number(t)||0)},divided_by:function(n,t){return(Number(n)||0)/(Number(t)||0)},modulo:function(n,t){return(Number(n)||0)%(Number(t)||0)},map:function(n,t){var r,i;for(n=n||[],r=[],i=0;i<n.length;i++)r.push(n[i][t]);return r},escape_once:function(n){var t=this;return n.replace(/["><']|&(?!([a-zA-Z]+|(#\d+));)/g,function(n){return t._HTML_ESCAPE_MAP[n]})},remove:function(n,t){return n.toString().replace(new RegExp(t,"g"),"")},remove_first:function(n,t){return n.toString().replace(t,"")},prepend:function(n,t){return""+(t||"").toString()+(n||"").toString()},append:function(n,t){return""+(n||"").toString()+(t||"").toString()}});(new Date).strftime||function(){Date.ext={};Date.ext.util={};Date.ext.util.xPad=function(n,t,i){for(typeof i=="undefined"&&(i=10);parseInt(n,10)<i&&i>1;i/=10)n=t.toString()+n;return n.toString()};Date.prototype.locale="en-GB";document.getElementsByTagName("html")&&document.getElementsByTagName("html")[0].lang&&(Date.prototype.locale=document.getElementsByTagName("html")[0].lang);Date.ext.locales={};Date.ext.locales.en={a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],c:"%a %d %b %Y %T %Z",p:["AM","PM"],P:["am","pm"],x:"%d/%m/%y",X:"%T"};Date.ext.locales["en-US"]=typeof JSON!="undefined"?JSON.parse(JSON.stringify(Date.ext.locales.en)):Date.ext.locales.en;Date.ext.locales["en-US"].c="%a %d %b %Y %r %Z";Date.ext.locales["en-US"].x="%D";Date.ext.locales["en-US"].X="%r";Date.ext.locales["en-GB"]=Date.ext.locales.en;Date.ext.locales["en-AU"]=Date.ext.locales["en-GB"];Date.ext.formats={a:function(n){return Date.ext.locales[n.locale].a[n.getDay()]},A:function(n){return Date.ext.locales[n.locale].A[n.getDay()]},b:function(n){return Date.ext.locales[n.locale].b[n.getMonth()]},B:function(n){return Date.ext.locales[n.locale].B[n.getMonth()]},c:"toLocaleString",C:function(n){return Date.ext.util.xPad(parseInt(n.getFullYear()/100,10),0)},d:["getDate","0"],e:["getDate"," "],g:function(n){return Date.ext.util.xPad(parseInt(Date.ext.util.G(n)/100,10),0)},G:function(n){var t=n.getFullYear(),i=parseInt(Date.ext.formats.V(n),10),r=parseInt(Date.ext.formats.W(n),10);return r>i?t++:r===0&&i>=52&&t--,t},H:["getHours","0"],I:function(n){var t=n.getHours()%12;return Date.ext.util.xPad(t===0?12:t,0)},j:function(n){var t=n-new Date(""+n.getFullYear()+"/1/1 GMT"),i;return t+=n.getTimezoneOffset()*6e4,i=parseInt(t/864e5,10)+1,Date.ext.util.xPad(i,0,100)},m:function(n){return Date.ext.util.xPad(n.getMonth()+1,0)},M:["getMinutes","0"],p:function(n){return Date.ext.locales[n.locale].p[n.getHours()>=12?1:0]},P:function(n){return Date.ext.locales[n.locale].P[n.getHours()>=12?1:0]},S:["getSeconds","0"],u:function(n){var t=n.getDay();return t===0?7:t},U:function(n){var t=parseInt(Date.ext.formats.j(n),10),i=6-n.getDay(),r=parseInt((t+i)/7,10);return Date.ext.util.xPad(r,0)},V:function(n){var r=parseInt(Date.ext.formats.W(n),10),i=new Date(""+n.getFullYear()+"/1/1").getDay(),t=r+(i>4||i<=1?0:1);return t==53&&new Date(""+n.getFullYear()+"/12/31").getDay()<4?t=1:t===0&&(t=Date.ext.formats.V(new Date(""+(n.getFullYear()-1)+"/12/31"))),Date.ext.util.xPad(t,0)},w:"getDay",W:function(n){var t=parseInt(Date.ext.formats.j(n),10),i=7-Date.ext.formats.u(n),r=parseInt((t+i)/7,10);return Date.ext.util.xPad(r,0,10)},y:function(n){return Date.ext.util.xPad(n.getFullYear()%100,0)},Y:"getFullYear",z:function(n){var t=n.getTimezoneOffset(),i=Date.ext.util.xPad(parseInt(Math.abs(t/60),10),0),r=Date.ext.util.xPad(t%60,0);return(t>0?"-":"+")+i+r},Z:function(n){return n.toString().replace(/^.*\(([^)]+)\)$/,"$1")},"%":function(){return"%"}};Date.ext.aggregates={c:"locale",D:"%m/%d/%y",h:"%b",n:"\n",r:"%I:%M:%S %p",R:"%H:%M",t:"\t",T:"%H:%M:%S",x:"locale",X:"locale"};Date.ext.aggregates.z=Date.ext.formats.z(new Date);Date.ext.aggregates.Z=Date.ext.formats.Z(new Date);Date.ext.unsupported={};Date.prototype.strftime=function(n){var t,i;for((this.locale in Date.ext.locales)||(this.locale=this.locale.replace(/-[a-zA-Z]+$/,"")in Date.ext.locales?this.locale.replace(/-[a-zA-Z]+$/,""):"en-GB"),t=this;n.match(/%[cDhnrRtTxXzZ]/);)n=n.replace(/%([cDhnrRtTxXzZ])/g,function(n,i){var r=Date.ext.aggregates[i];return r=="locale"?Date.ext.locales[t.locale][i]:r});return i=n.replace(/%([aAbBCdegGHIjmMpPSuUVwWyY%])/g,function(n,i){var r=Date.ext.formats[i];return typeof r=="string"?t[r]():typeof r=="function"?r.call(t,t):typeof r=="object"&&typeof r[0]=="string"?Date.ext.util.xPad(t[r[0]](),r[1]):i}),t=null,i}}();
/*!
 * Cross-Browser Split 1.1.1
 * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 * Available under the MIT License
 * ECMAScript compliant, uniform cross-browser split method
 */
split=split||function(n){var r=String.prototype.split,i=/()??/.exec("")[1]===n,t;return t=function(t,u,f){if(Object.prototype.toString.call(u)!=="[object RegExp]")return r.call(t,u,f);var o=[],c=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.extended?"x":"")+(u.sticky?"y":""),s=0,u=new RegExp(u.source,c+"g"),l,e,h,a;for(t+="",i||(l=new RegExp("^"+u.source+"$(?!\\s)",c)),f=f===n?-1>>>0:f>>>0;e=u.exec(t);){if(h=e.index+e[0].length,h>s&&(o.push(t.slice(s,e.index)),!i&&e.length>1&&e[0].replace(l,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===n&&(e[t]=n)}),e.length>1&&e.index<t.length&&Array.prototype.push.apply(o,e.slice(1)),a=e[0].length,s=h,o.length>=f))break;u.lastIndex===e.index&&u.lastIndex++}return s===t.length?(a||!u.test(""))&&o.push(""):o.push(t.slice(s)),o.length>f?o.slice(0,f):o},String.prototype.split=function(n,i){return t(this,n,i)},t}();